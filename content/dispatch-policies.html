<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/activemq-website/assets/img/favicon.png">

    <link rel="stylesheet" href="/activemq-website/css/main.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="#"><img src="/activemq-website/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/activemq-website/index.html">Home</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownProjects" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects</a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownProjects">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Projects</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/classic">ActiveMQ 5</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contact</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Contact</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#mailing">Mailing Lists</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#chat">Chat</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#contributing">Contributing</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <!--li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Team</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Team</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li-->
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apache</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Apache</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/security/">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-activemq5">
    <div class="container">
      <h1>Dispatch Policies</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 activemq5">
        <p><a href="features">Features</a> &gt; <a href="message-dispatching-features">Message Dispatching Features</a> &gt; <a href="dispatch-policies">Dispatch Policies</a></p>

<h1 id="dispatch-policies">Dispatch Policies</h1>

<h2 id="dispatch-policies-for-queues">Dispatch policies for queues</h2>

<p>Plug-able dispatch policies only apply to topics. For Queues, dispatch is more static, you can choose round robin (the default) or strict order. Before discussing dispatch policies its worth first understanding <a href="what-is-the-prefetch-limit-for">the purpose of the prefetch value</a>.</p>

<p>The out of the box configuration of ActiveMQ is designed for high performance and high throughput messaging where there are lots of messages that need to be dispatched to consumers as quickly as possible. So the default prefetch values are fairly large and the default dispatch policy will try and fill the prefetch buffers as quickly as possible.</p>

<p>However with messaging there are many use cases and sometimes the default configuration is not ideal to your use case; when you send a small number of messages, they tend to all go to one consumer unless you’ve lots of messages. If you have a large number of consumers and a relatively high <a href="what-is-the-prefetch-limit-for">prefetch value</a> and you have a small number of messages that each message takes quite a while to process then the default dispatch policy might result in increasing the amount of time it takes to process all the messages (since the load balancing is not fair for small numbers of messages).</p>

<p>For queues, you can define whether the dispatch will occur in a round-robin fashion (default behaviour) or if one consumer’s prefetch buffer will be exhausted before the dispatch process selects the next consumer along (strictOrderDispatch).</p>

<p>The latter behaviour is enabled by setting the <code class="highlighter-rouge">strictOrderDispatch</code> attribute on the <code class="highlighter-rouge">&lt;policyEntry /&gt;</code> element. E.g.:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;policyEntry queue="&gt;" strictOrderDispatch="false" /&gt;
</code></pre></div></div>
<p>Consumer priorities are observed, so if you have several consumers with different <a href="consumer-priority">priorities</a>, the one with the highest priority will be flooded first until it can take no more, then the next one along, etc.</p>

<p>From version 5.14.0 - the strictOrderDispatch=true option will ensure strict order for redispatched messages when there is a single consumer. </p>

<h2 id="dispatch-policies-for-topics">Dispatch policies for Topics</h2>

<p>There are more options for topics because the dispatch policy is plug-able. Any implementation of org.apache.activemq.broker.region.policy.DispatchPolicy will work.</p>

<p>The default <code class="highlighter-rouge">org.apache.activemq.broker.region.policy.SimpleDispatchPolicy</code> does what one would expect and delivers messages to all subscribers. An example of a more advanced implementation is the <code class="highlighter-rouge">org.apache.activemq.broker.region.policy.PriorityNetworkDispatchPolicy</code> which will only dispatch to the highest priority network consumer. This is useful in a loop network topology where there is more than route to a consumer.</p>

<p>Here is an <a href="http://svn.apache.org/repos/asf/activemq/trunk/activemq-unit-tests/src/test/resources/org/apache/activemq/xbean/activemq-policy.xml">example of destination policy configuration</a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;destinationPolicy&gt;
   &lt;policyMap&gt;
      &lt;policyEntries&gt;
         &lt;policyEntry topic="FOO.&gt;"&gt;
            &lt;dispatchPolicy&gt;
               &lt;roundRobinDispatchPolicy /&gt;
            &lt;/dispatchPolicy&gt;
            &lt;subscriptionRecoveryPolicy&gt;
               &lt;lastImageSubscriptionRecoveryPolicy /&gt;
            &lt;/subscriptionRecoveryPolicy&gt;
         &lt;/policyEntry&gt;
         &lt;policyEntry topic="ORDERS.&gt;"&gt;
            &lt;dispatchPolicy&gt;
               &lt;strictOrderDispatchPolicy /&gt;
            &lt;/dispatchPolicy&gt;
            &lt;!-- 1 minutes worth --&gt;
            &lt;subscriptionRecoveryPolicy&gt;
               &lt;timedSubscriptionRecoveryPolicy recoverDuration="60000" /&gt; 
            &lt;/subscriptionRecoveryPolicy&gt;
         &lt;/policyEntry&gt;
         &lt;policyEntry topic="PRICES.&gt;"&gt;
            &lt;!-- lets force old messages to be discarded for slow consumers --&gt; 
            &lt;pendingMessageLimitStrategy&gt;
               &lt;constantPendingMessageLimitStrategy limit="10"/&gt;
            &lt;/pendingMessageLimitStrategy&gt;
            &lt;!-- 10 seconds worth --&gt;
            &lt;subscriptionRecoveryPolicy&gt;
               &lt;timedSubscriptionRecoveryPolicy recoverDuration="10000" /&gt;
            &lt;/subscriptionRecoveryPolicy&gt;
         &lt;/policyEntry&gt;
         &lt;policyEntry tempTopic="true" advisoryForConsumed="true" /&gt;
         &lt;policyEntry tempQueue="true" advisoryForConsumed="true" /&gt;
      &lt;/policyEntries&gt;
   &lt;/policyMap&gt;
&lt;/destinationPolicy&gt;
</code></pre></div></div>

      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/activemq-website/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p>Apache ActiveMQ, ActiveMQ, ActiveMQ Artemis, Apache, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2019, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/activemq-website/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
