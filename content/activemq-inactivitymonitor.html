<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/activemq-website/assets/img/favicon.png">

    <link rel="stylesheet" href="/activemq-website/css/main.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="#"><img src="/activemq-website/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/activemq-website/index.html">Home</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownProjects" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects</a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownProjects">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Projects</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/classic">ActiveMQ 5</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contact</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Contact</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#mailing">Mailing Lists</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#chat">Chat</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#contributing">Contributing</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <!--li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Team</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Team</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li-->
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apache</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Apache</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/security/">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-activemq5">
    <div class="container">
      <h1>ActiveMQ InactivityMonitor</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 activemq5">
        <p><a href="using-activemq">Using ActiveMQ</a> &gt; <a href="configuring-transports">Configuring Transports</a> &gt; <a href="activemq-inactivitymonitor">ActiveMQ InactivityMonitor</a></p>

<h1 id="activemq-inactivitymonitor">ActiveMQ InactivityMonitor</h1>

<p>The ActiveMQ InactivityMonitor is an active thread that checks the connection is still active and if it suspects the connection is not functioning correctly, it closes the connection.</p>

<p>Connections are monitored by:</p>

<ul>
  <li>Ensuring data is read from the connection during the specified time period (Max Inactivity Duration).</li>
  <li>Writing a <code class="highlighter-rouge">KeepAliveInfo</code> message to the connection if no <strong>normal</strong> activemq traffic is sent across the connection during the specified time period.</li>
</ul>

<p>Each connection has two InactivityMonitors associated, one on each end of the connection. The InactivityMonitor expects to receive data on the connection during a specified time period. If <strong>normal</strong> ActiveMQ traffic has not been sent across the connection during that period, it expects to receive a <code class="highlighter-rouge">KeepAliveInfo</code> message sent by the InactivityMonitor on the other end of the connection.</p>

<p>Using the default values; if no data has been written or read from the connection for 30 seconds, the InactivityMonitor kicks in. The InactivityMonitor throws an <code class="highlighter-rouge">InactivityIOException</code> and shuts down the transport associated with the connection. This results in the following <code class="highlighter-rouge">DEBUG</code> logging:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2012-06-26 17:13:55,712 | DEBUG | 30000 ms elapsed since last read check. | org.apache.activemq.transport.AbstractInactivityMonitor | InactivityMonitor ReadCheck
2012-06-26 17:13:55,712 | DEBUG | No message received since last read check for tcp:///127.0.0.1:52659! Throwing InactivityIOException. | org.apache.activemq.transport.AbstractInactivityMonitor | InactivityMonitor ReadCheck
2012-06-26 17:13:55,714 | DEBUG | Transport Connection to: tcp://127.0.0.1:52659 failed: 
org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (&gt;30000) long: tcp://127.0.0.1:52659 |
org.apache.activemq.broker.TransportConnection.Transport | InactivityMonitor Async Task: 
java.util.concurrent.ThreadPoolExecutor$Worker@6a346239
org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (&gt;30000) long: tcp://127.0.0.1:52659
    at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:187)
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
    at java.lang.Thread.run(Thread.java:680)
</code></pre></div></div>

<h3 id="advanced-inactivitymonitor-configuration">Advanced InactivityMonitor Configuration</h3>

<p>There are some configuration options to further fine tune the <code class="highlighter-rouge">InactivityMonitor</code>. Note, for most use cases the default values are just fine.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">wireFormat.maxInactivityDuration</code></td>
      <td><code class="highlighter-rouge">30000</code></td>
      <td>Timeout, in milliseconds, after which the connection is closed by the broker if no data has been received.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">wireFormat.maxInactivityDurationInitalDelay</code></td>
      <td><code class="highlighter-rouge">10000</code></td>
      <td>Specifies the maximum delay, in milliseconds, before connection inactivity monitoring is started. This can prove useful if a broker is under load with many connections being created concurrently.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">transport.useInactivityMonitor</code></td>
      <td><code class="highlighter-rouge">true</code></td>
      <td>A value of <code class="highlighter-rouge">false</code> disables the <code class="highlighter-rouge">InactivityMonitor</code> completely and connections will never time out.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">transport.useKeepAlive</code></td>
      <td><code class="highlighter-rouge">true</code></td>
      <td>Determines if a <code class="highlighter-rouge">KeepAliveInfo</code> message should be sent on an idle connection to prevent it from timing out. Disabling the keep alive will still make connections time out when no data was received on the connection for the specified amount of time.</td>
    </tr>
  </tbody>
</table>

<p>These parameters can be specified directly on the client side connection URL, e.g. <code class="highlighter-rouge">tcp://localhost:61616?wireFormat.maxInactivityDuration=30000</code>,** or on the broker’s transport connector URL:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;transportConnectors&gt;
  &lt;transportConnector name="openwire" uri="tcp://0.0.0.0:61616?wireFormat.maxInactivityDuration=30000&amp;amp;wireFormat.maxInactivityDurationInitalDelay=10000"/&gt;
&lt;/transportConnectors&gt;
</code></pre></div></div>
<h3 id="what-happens-if-themaxinactivityduration-and-maxinactivitydurationinitaldelay-are-set-to-different-values-on-either-side-of-the-same-connection">What happens if the <code class="highlighter-rouge">maxInactivityDuration</code> and <code class="highlighter-rouge">maxInactivityDurationInitalDelay</code> are set to different values on either side of the same connection?</h3>

<p>At startup the InactivityMonitor negotiates the appropriate <code class="highlighter-rouge">maxInactivityDuration</code> and <code class="highlighter-rouge">maxInactivityDurationInitalDelay</code>. The shortest duration is taken for the connection.</p>

<h3 id="can-the-inactivitymonitor-on-a-connection-be-disabled">Can the InactivityMonitor on a connection be disabled?</h3>

<p>Setting <code class="highlighter-rouge">transport.useInactivityMonitor=false</code> will disable the InactivityMonitor. Configuring <code class="highlighter-rouge">wireFormat.maxInactivityDuration=0</code> will achieve the same result.</p>

<h3 id="potential-issues">Potential Issues</h3>

<p><a href="slow-networks-drop-large-messages">slow-networks-drop-large-messages</a></p>


      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/activemq-website/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p>Apache ActiveMQ, ActiveMQ, ActiveMQ Artemis, Apache, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2019, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/activemq-website/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
