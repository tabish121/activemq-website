<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/activemq-website/assets/img/favicon.png">

    <link rel="stylesheet" href="/activemq-website/css/main.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="#"><img src="/activemq-website/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/activemq-website/index.html">Home</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownProjects" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects</a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownProjects">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Projects</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/classic">ActiveMQ 5</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/projects/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contact</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Contact</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#mailing">Mailing Lists</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#chat">Chat</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/contact#contributing">Contributing</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <!--li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Team</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Team</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li-->
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apache</a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <h6 class="dropdown-header">Apache</h6>
                                    <div class="dropdown-divider"></div>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/security/">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/activemq-website/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-activemq5">
    <div class="container">
      <h1>REST</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 activemq5">
        <p><a href="connectivity">Connectivity</a> &gt; <a href="protocols">Protocols</a> &gt; <a href="rest">REST</a></p>

<p>ActiveMQ implements a RESTful API to messaging which allows any web capable device to publish or consume messages using a regular HTTP POST or GET.</p>

<p>If you are interested in messaging directly from web browsers you might wanna check out our <a href="ajax">Ajax</a> or <a href="websockets">WebSockets</a> support or try <a href="web-samples">running the REST examples</a></p>

<h2 id="mapping-of-rest-to-jms">Mapping of REST to JMS</h2>

<p>To publish a message use a HTTP POST. To consume a message use HTTP DELETE or GET.</p>

<p>ActiveMQ has a Servlet that takes care of the integration between HTTP and the ActiveMQ dispatcher.</p>

<p>NOTE: The example below requires servlet mapping on the URL. For posting without the servlet mapping, see examples further down.</p>

<p>You can map a URI to the servlet and then use the relative part of the URI as the topic or queue name. e.g. you could HTTP POST to</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://www.acme.com/orders/input
</code></pre></div></div>
<p>which would publish the contents of the HTTP POST to the orders.input queue on JMS. </p>

<p>Similarly you could perform a HTTP DELETE GET on the above URL to read from the same queue. In this case we will map the MessageServlet from ActiveMQ to the URI</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://www.acme.com/queue
</code></pre></div></div>
<p>and configure it to accept the URI as a queue destination. We can do similar things to support topic destinations too.</p>

<p>We can use the HTTP session to denote a unique publisher or consumer.</p>

<p>Note that strict REST requires that GET be a read only operation; so strictly speaking we should not use GET to allow folks to consume messages. Though we allow this as it simplifies HTTP/DHTML/Ajax integration somewhat.</p>

<p>For a more cleaner mapping of a simple transfer protocol to different languages, you might wish to take a look at <a href="stomp">Stomp</a>.</p>

<h2 id="default-configuration">Default configuration</h2>

<p>Until version 5.8, REST API was part of the <a href="web-samples">Web Samples</a> and was mapped to <a href="http://localhost:8161/demo/message">http://localhost:8161/demo/message</a> url. From 5.8 onwards, the API is available by default at <a href="http://localhost:8161/api/message">http://localhost:8161/api/message</a> url. Also, starting with 5.8, web server is secured by default (see <a href="web-console">Web Console</a> for more information), so have that in mind when trying to use it. Examples below will assume new api location and secured web server.</p>

<h3 id="producing">Producing</h3>

<p>You can produce by sending a POST request to the server, like</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -u admin:admin -d "body=message" http://localhost:8161/api/message/TEST?type=queue
</code></pre></div></div>
<p>NOTE: If no type parameter is specified, the default is to create a  topic. To change the default to queue, initialize  the servlet  with an init param in the <code class="highlighter-rouge">webapps/demo/WEB-INF/web.xml</code></p>

<p>As shown below:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;servlet&gt;
  &lt;servlet-name&gt;MessageServlet&lt;/servlet-name&gt;  
  &lt;servlet-class&gt;org.apache.activemq.web.MessageServlet&lt;/servlet-class&gt;
  &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;init-param&gt;
     &lt;param-name&gt;topic&lt;/param-name&gt;
     &lt;param-value&gt;false&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/servlet&gt;
</code></pre></div></div>

<h4 id="alternate-producing-syntax">Alternate Producing Syntax</h4>

<p>An alternative syntax for posting is supported, using the destination URL-encoded parameter; here are some examples: </p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Send to queue orders.input:
curl -XPOST -d "body=message" http://admin:admin@localhost:8161/api/message?destination=queue://orders.input
 
# Send to topic orders.input:
curl -XPOST -d "body=message" http://admin:admin@localhost:8161/api/message?destination=topic://orders.input
</code></pre></div></div>

<h3 id="timeouts">Timeouts</h3>

<p>When reading from a queue we might not have any messages. We can use a timeout query parameter to indicate how long we are prepared to wait for a message to arrive. This allows us to poll or block until a message arrives.</p>

<p>Couple this with HTTP 1.1 keep-alive sockets and pipeline processing we can have efficient access to JMS over HTTP.</p>

<p>Obviously if your client is Java then using ActiveMQ’s JMS API is the fastest and most efficient way to work with the message broker; however, if you are not using Java or prefer the simplicity of HTTP then it should be fairly efficient, especially if your HTTP client supports keep-alive sockets and pipeline processing.</p>

<h4 id="consuming">Consuming</h4>

<p>When consuming messages using the REST API, you have to keep session alive between GET requests, or you’ll create a separate consumer for every request and due to prefetch limit your succeeding call will hang.</p>

<p>For example, you can use <code class="highlighter-rouge">wget</code> to consume messages, like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget --user admin --password admin --save-cookies cookies.txt --load-cookies cookies.txt --keep-session-cookies  http://localhost:8161/api/message/TEST1?type=queue
</code></pre></div></div>
<p>Also, if you plan to have multiple consumer using REST, it’s advisable to set prefetch size to 1 so all consumers have an equal chance of getting the message. You can do that by passing a special parameter to the <code class="highlighter-rouge">MessageServlet</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;servlet&gt;
    &lt;servlet-name&gt;MessageServlet&lt;/servlet-name&gt;       
    &lt;servlet-class&gt;org.apache.activemq.web.MessageServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;init-param&gt;
            &lt;param-name&gt;destinationOptions&lt;/param-name&gt;
            &lt;param-value&gt;consumer.prefetchSize=1&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/servlet&gt;
</code></pre></div></div>
<p>in the <code class="highlighter-rouge">webapps/demo/WEB-INF/web.xml</code></p>

<h4 id="alternate-consuming-syntax">Alternate Consuming Syntax</h4>

<p>As with producing, an alternative syntax for consuming messages is also supported, using the destination URL-encoded parameter; here are some examples: </p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Send to queue orders.input:
curl -XGET http://admin:admin@localhost:8161/api/message?destination=queue://orders.input
 
# Send to topic orders.input:
curl -XGET http://admin:admin@localhost:8161/api/message?destination=topic://orders.input
</code></pre></div></div>

<h4 id="consuming-without-sessions">Consuming without sessions</h4>

<p>Since 5.2.0 you can use <code class="highlighter-rouge">clientId</code> parameter to avoid storing actual JMS consumer in the request session. When using this approach, you don’t need to keep sessions alive between requests, you just need to use the same <code class="highlighter-rouge">clientId</code> every time.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget --user admin --password admin http://localhost:8161/api/message/test?type=queue&amp;clientId=consumerA
</code></pre></div></div>
<p>Every such call will use the same JMS consumer and deliver messages send to it by the broker.</p>

<p>In 5.4.1 it’s also possible to unsubscribe the client. It’s done by sending a POST call with <code class="highlighter-rouge">clientId</code> and <code class="highlighter-rouge">action=unsubscribe</code> parameters to the server, like</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost:8161/demo/message/test?clientId=consumerA&amp;action=unsubscribe
</code></pre></div></div>

<h3 id="consuming-with-selectors">Consuming with selectors</h3>

<p>As of ActiveMQ 5.4.0, you can use selectors when consuming using REST protocol. To do that, just specify the appropriate header with selector. To define a selector for the consumer, you have to provide it in an appropriate HTTP header. By default selector header name is <code class="highlighter-rouge">selector</code>, so the following example</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget  --user admin --password admin --save-cookies cookies.txt --load-cookies cookies.txt --keep-session-cookies  --header="selector: test=2" http://localhost:8161/api/message/test?type=queue
</code></pre></div></div>
<p>should consume only messages that have <code class="highlighter-rouge">test</code> property set to <code class="highlighter-rouge">2</code>.</p>

<p>You can change the name of the selector header using the <code class="highlighter-rouge">org.apache.activemq.selectorName</code> Servlet context property in <code class="highlighter-rouge">WEB-INF/web.xml</code>, such as</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;context-param&gt;
    &lt;param-name&gt;org.apache.activemq.selectorName&lt;/param-name&gt;
    &lt;param-value&gt;activemq-selector&lt;/param-value&gt;
&lt;/context-param&gt;
</code></pre></div></div>
<p>For more info, take a look at <a href="http://fisheye6.atlassian.com/browse/activemq/trunk/activemq-web-demo/src/test/java/org/apache/activemq/web/RestTest.java?r=HEAD">RestTest</a></p>

<h3 id="consuming-with-one-shot-consumers">Consuming with One Shot Consumers</h3>

<p>One shot consumption allows a REST call to receive a single message and then immediately close the associated consumer.</p>

<p>All of the examples so far lead to the servlet creating and holding on to consumers of the destination across multiple HTTP requests. Without care, these consumers could easily lead to confusion as messages are dispatched to them but then sit unused because the consuming HTTP session, or clientId, fails to connect to continue requesting the messages. One way around that problem is the use of one-shot consumers.  Simple add the <code class="highlighter-rouge">?oneShot=true</code> option and the consumer is removed once the consumption completes; as follows:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XGET http://admin:admin@localhost:8161/api/message?destination=queue://orders.input&amp;oneShot=true
</code></pre></div></div>
<p>Note that interrupting the call while the consumer is waiting for a message, the consumer may remain until the server times out the HTTP request, or until a message finally arrives.</p>

<h3 id="content-types">Content Types</h3>

<p>By default messages are sent to the consumers with <code class="highlighter-rouge">text/xml</code> content type. Your REST-based application may expect JSON response instead of XML one. In that case, you can configure the servlet to send responses back by adding something like this</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;servlet&gt;
    &lt;servlet-name&gt;MessageServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.activemq.web.MessageServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;init-param&gt;
            &lt;param-name&gt;defaultContentType&lt;/param-name&gt;
            &lt;param-value&gt;application/json&lt;/param-value&gt;
    &lt;/init-param&gt; 
&lt;/servlet&gt;
</code></pre></div></div>
<p>to your <code class="highlighter-rouge">WEB-INF/web.xml</code>.</p>

<p>A default content type can also be overridden using request headers. Specifying <code class="highlighter-rouge">xml=true</code> or <code class="highlighter-rouge">json=true</code> URL parameter you’ll get a response with the desired content type.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget --user admin --password admin http://localhost:8161/api/message/TEST?type=queue\\&amp;clientId=A\\&amp;json=true
</code></pre></div></div>

<h3 id="security">Security</h3>

<p>Since 5.7.0 release REST API can connect to the secured brokers. The API uses basic authentication header format to get username and password information.</p>

<p>For example, with curl you can do something like</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -u system:manager -d "body=message" http://localhost:8161/demo/message/TEST?type=queue
</code></pre></div></div>
<p>Also, you might want to enable <code class="highlighter-rouge">ssl</code> for your connections. To do that, just uncomment SecureConnector in <code class="highlighter-rouge">conf/jetty.xml</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;bean id="SecureConnector" class="org.eclipse.jetty.server.ssl.SslSelectChannelConnector"&gt;
    &lt;property name="port" value="8162" /&gt;
    &lt;property name="keystore" value="file:${activemq.conf}/broker.ks" /&gt;
    &lt;property name="password" value="password" /&gt;
&lt;/bean&gt;
</code></pre></div></div>

<h2 id="rest-management">Rest Management</h2>

<p>Starting with version 5.8 we provide a REST management API for the broker. Using <a href="http://www.jolokia.org/">Jolokia</a> JMX-HTTP bridge it’s possible to access all broker metrics (like memory usage) and execute management operations (like purging queues) using REST API. By default the management API is exposed at <a href="http://localhost:8161/api/jolokia/">http://localhost:8161/api/jolokia/</a> URL. So you can for example get basic broker data with</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget --user admin --password admin --auth-no-challenge http://localhost:8161/api/jolokia/read/org.apache.activemq:type=Broker,brokerName=localhost
</code></pre></div></div>
<p>or to be more specific, total consumer count with</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget --user admin --password admin --auth-no-challenge http://localhost:8161/api/jolokia/read/org.apache.activemq:type=Broker,brokerName=localhost/TotalConsumerCount
</code></pre></div></div>
<p>For more information on Jolokia protocol, see its reference manual. An API like this makes it easy to script monitoring and management operations against the broker, see also <a href="how-can-i-monitor-activemq">How can I monitor ActiveMQ</a>?</p>

<h2 id="gotchas-and-other-trivia">Gotcha’s and other trivia</h2>

<ol>
  <li>Missing “body” parameter</li>
</ol>

<p>In the curl POST examples above, the use of “body=…” is critical. If this is not specified in front of the message body contents, the web servlet will attempt to read the body from the request (rather than from the -d parameter), and this will result in the following exception:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.lang.IllegalStateException: STREAMED
at org.eclipse.jetty.server.Request.getReader(Request.java:898)
at org.apache.activemq.web.MessageServletSupport.getPostedMessageBody(MessageServletSupport.java:347)
at org.apache.activemq.web.MessageServlet.doPost(MessageServlet.java:126)
...
</code></pre></div></div>
<p>However, one option in this case would be to specify the content type explicitly:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -u admin:admin -d "hello world $(date)" -H "Content-Type: text/plain" -XPOST http://localhost:8161/api/message?destination=queue://abc.def
</code></pre></div></div>

      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/activemq-website/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p>Apache ActiveMQ, ActiveMQ, ActiveMQ Artemis, Apache, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2019, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/activemq-website/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
